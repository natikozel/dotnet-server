@page
@model Connect4Server.Pages.PlayersModel
@{
    ViewData["Title"] = "Players";
    ViewData["AdditionalStyles"] = "~/css/players.css";
}

@section Scripts {
    <script src="~/js/players.js" asp-append-version="true"></script>
}

<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <h1>ğŸ‘¥ Registered Players</h1>
        <p class="lead">Explore our Connect 4 community and player statistics</p>
    </div>
</section>

<!-- Query Controls -->
<section class="query-section">
    <div class="container">
        <div class="card shadow-medium">
            <div class="card-header">
                <h4 class="mb-0">ğŸ” Filter Players</h4>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <form method="post">
                            <button type="submit" class="btn btn-primary w-100" asp-page-handler="ShowAll">
                                ğŸ“‹ Show All Players
                            </button>
                        </form>
                    </div>
                    <div class="col-md-3">
                        <form method="post">
                            <button type="submit" class="btn btn-success w-100" asp-page-handler="ShowWinners">
                                ğŸ† Players with Wins
                            </button>
                        </form>
                    </div>
                    <div class="col-md-6">
                        <form method="post" class="d-flex">
                            <input type="text" class="form-control me-2" name="Country" 
                                   placeholder="ğŸŒ Enter country name..." />
                            <button type="submit" class="btn btn-info" asp-page-handler="ByCountry">
                                ğŸŒ Filter by Country
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Players Results -->
@if (Model.Players != null && Model.Players.Any())
{
    <section class="results-section">
        <div class="container">
            <!-- Summary Statistics -->
            <div class="stats-grid mb-4">
                <div class="stats-card">
                    <span class="stats-icon">ğŸ‘¥</span>
                    <div class="stats-number">@Model.Players.Count()</div>
                    <div class="stats-label">Total Players</div>
                </div>
                <div class="stats-card">
                    <span class="stats-icon">ğŸ†</span>
                    <div class="stats-number">@Model.Players.Sum(p => p.GamesWon)</div>
                    <div class="stats-label">Total Wins</div>
                </div>
                <div class="stats-card">
                    <span class="stats-icon">ğŸ®</span>
                    <div class="stats-number">@Model.Players.Sum(p => p.GamesPlayed)</div>
                    <div class="stats-label">Games Played</div>
                </div>
                <div class="stats-card">
                    <span class="stats-icon">ğŸŒ</span>
                    <div class="stats-number">@Model.Players.Select(p => p.Country).Distinct().Count()</div>
                    <div class="stats-label">Countries</div>
                </div>
            </div>

            <!-- Players Table -->
            <div class="card shadow-large">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">ğŸ“Š Player Statistics (@Model.Players.Count() results)</h4>
                        <div class="d-flex gap-2">
                            <span class="badge bg-primary">@Model.Players.Count() Players</span>
                            <span class="badge bg-success">@Model.Players.Count(p => p.GamesWon > 0) Winners</span>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th class="text-center">ğŸ†” Player ID</th>
                                    <th>ğŸ‘¤ Name</th>
                                    <th>ğŸ“± Phone</th>
                                    <th>ğŸŒ Country</th>
                                    <th class="text-center">ğŸ“… Joined</th>
                                    <th class="text-center">ğŸ® Played</th>
                                    <th class="text-center">ğŸ† Won</th>
                                    <th class="text-center">âŒ Lost</th>
                                    <th class="text-center">ğŸ“ˆ Win Rate</th>
                                    <th class="text-center">ğŸ… Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var player in Model.Players.OrderByDescending(p => p.GamesWon).ThenByDescending(p => p.GamesPlayed))
                                {
                                    <tr>
                                        <td class="text-center">
                                            <span class="badge bg-primary rounded-pill">@player.PlayerId</span>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="player-avatar me-2">
                                                    @player.FirstName.Substring(0, 1).ToUpper()
                                                </div>
                                                <strong>@player.FirstName</strong>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="text-muted">@player.PhoneNumber</span>
                                        </td>
                                        <td>
                                            <span class="country-badge">@player.Country</span>
                                        </td>
                                        <td class="text-center">
                                            <small class="text-muted">@player.RegistrationDate.ToString("MMM dd, yyyy")</small>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-info">@player.GamesPlayed</span>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-success">@player.GamesWon</span>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-danger">@player.GamesLost</span>
                                        </td>
                                        <td class="text-center">
                                            @if (player.GamesPlayed > 0)
                                            {
                                                var winRate = (double)player.GamesWon / player.GamesPlayed * 100;
                                                <div class="win-rate">
                                                    <span class="win-rate-text">@($"{winRate:F1}%")</span>
                                                    <div class="win-rate-bar">
                                                        <div class="win-rate-fill" data-width="@($"{winRate}%")"></div>
                                                    </div>
                                                </div>
                                            }
                                            else
                                            {
                                                <span class="text-muted">-</span>
                                            }
                                        </td>
                                        <td class="text-center">
                                            @if (player.GamesWon >= 10)
                                            {
                                                <span class="status-badge legendary">ğŸ… Legend</span>
                                            }
                                            else if (player.GamesWon >= 5)
                                            {
                                                <span class="status-badge expert">â­ Expert</span>
                                            }
                                            else if (player.GamesWon > 0)
                                            {
                                                <span class="status-badge player">ğŸ® Player</span>
                                            }
                                            else
                                            {
                                                <span class="status-badge newcomer">ğŸ†• Newcomer</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
}
else if (Model.QueryExecuted)
{
    <section class="no-results-section">
        <div class="container">
            <div class="card">
                <div class="card-body text-center py-5">
                    <div class="mb-4">
                        <span class="large-icon">ğŸ”</span>
                    </div>
                    <h4>No Results Found</h4>
                    <p class="text-muted mb-4">No players match your search criteria. Try adjusting your filters.</p>
                    <form method="post" class="d-inline">
                        <button type="submit" class="btn btn-primary" asp-page-handler="ShowAll">
                            ğŸ“‹ Show All Players
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>
}
else
{
    <section class="welcome-section">
        <div class="container">
            <div class="card">
                <div class="card-body text-center py-5">
                    <div class="mb-4">
                        <span class="large-icon">ğŸ‘¥</span>
                    </div>
                    <h4>Welcome to Players Dashboard</h4>
                    <p class="text-muted mb-4">Use the filter options above to explore player information and statistics.</p>
                    <div class="d-flex gap-2 justify-content-center">
                        <form method="post" class="d-inline">
                            <button type="submit" class="btn btn-primary" asp-page-handler="ShowAll">
                                ğŸ“‹ View All Players
                            </button>
                        </form>
                        <a asp-page="/Register" class="btn btn-success">
                            ğŸ“ Register New Player
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
}

 